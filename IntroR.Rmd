---
title: "Introduction to R"
author: "Selahattin Murat Sirin"
date: "08/09/2020"
output:
  ioslides_presentation: 
    widescreen: true
    smaller: true
  
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## Outline

 - R Ecosystem
 - R Basics
 - Data Analysis
 - Graphics
 - R Markdown

# BASIC R OPERATIONS
## R Ecosystem

R is a free  statistical computing software. It can be downloaded from CRAN website for free (https://cran.r-project.org/). The  latest version is R 4.0.2. If you have difficulties in installing the latest version, you can install older versions from (https://cran.r-project.org/src/base/R-3/)  - the last is the 3.6.3.  

RStudio’s IDE (Integrated Development Environment) offers a very versatile user interface. There are other IDEs; however, RStudio is the most popular among R users.
It can be installed from (https://rstudio.com/)

Most people want to use cloud services to save their work. RStudio can interface with Git(Hub). You can create a free GitHub account from (https://github.com/), and save your work in there.

## Functions and Packages 

R is an object-oriented programming which organizes software design around data, or objects, rather than functions and logic. An object can be defined as a data field that has unique attributes and behavior. 

Each function has 6 elements: 

1) Name and description
2) Usage
3) Arguments
4) Details
5) Values
6) Dependencies and references

```{r eval = FALSE}
## Check the sum function
sum
```

```{r eval = FALSE}
?sum
```


All functions are provided through packages, and it provides significant flexibility. On the other hand, unlike other statistical programs such as Stata or Eviews, each package has different function properties, so the same task can be done with diffent packages. Be careful about syntax!

```{r eval = FALSE, echo = TRUE}
install.packages()
library()
require()
```


## Example

An example using `install.packages` function

```{r eval = FALSE, echo = TRUE}
install.packages("dplyr", dependencies = TRUE)
```

Load installed package using `library` or `require` functions

```{r eval = FALSE, echo = TRUE}
library(dplyr)
require(dplyr)
```

You can also load package useing `p_load` function provided in **pacman** package. When sharing your work with others, this might be a better solution.

```{r eval = FALSE}
install.packages("pacman")
library(pacman)
p_load(dplyr)
```

Use `update.packages` function to update packages.

## Session Info

Always check your session before starting any project

```{r}
## Provides information about session
sessionInfo() 
```

## R objects

```{r}
a <- 5; b <- "a"; c <- TRUE
A <- c(1:5)
B <- c("a", "b", "c")
```

```{r}
class(a); class(b); class(c)
```

```{r}
class(A); class(B)
```

## Dates
 
```{r}
date1 <- as.Date("10/23/2016", format = "%m/%d/%Y")
date2 <- as.Date("23 October 16", format = "%d %B %y")
date3 <- as.Date("11/10/2016", format = "%m/%d/%Y")
```
 
```{r}
date1 - date2
weekdays(date2)
as.numeric(date3)
```
 
Besides base operations, **lubridate** package allows multiple operations with dates.

## Mathematical operations

```{r eval = FALSE}
5 + 5 # Addition
5 - 5 #  Subtraction
5 * 5 # Multiplication
5 / 5 # Division
0 / 0 # Division: Not a number (NaN) 
pi # Pi 
sqrt(5) # Square root
5^2 # Exponent 
5**2 # Exponent
5 %/% 2 # Division  
5%%2 # Modulo
abs(-5) # Absolute value
log(5) # ln
exp(5) # Exponent
log10(5) # log10
log2(5) # log2
round(5/2, digits = 2) # Rounding
signif(12345.6789, digits = 5) # Rounding
ceiling(5/2) # The highest integer
floor(5/2) # The lowest integer
trunc(5.48) # Integers formed by truncating the values in x toward 0
```

## Mathematical operations

Lag and Lead

```{r}
library(dplyr)
x <- seq(1:10)
lag(x,1)
```

```{r}
lag(x,2)
```

```{r}
lead(x,1)
```

```{r}
lead(x,2)
```

## Mathematical operations

Cumulative Sum, Cumulative Product, Extremes

```{r}
cumsum(x)
```

```{r}
cumprod(x)
```

```{r}
cummax(x)
cummin(x)
cummean(x)
```

## Mathematical operations

```{r}
x <- 1:20
first(x)
last(x)
nth(x,9)
range(x)
```

## R Operators

- <- Assign value
- =  Assign value
- :  Generate regular sequences
- c() Combine Values into a Vector or List
- (<) Smaller
- (>) Greater
- <= Smaller or equal
- >= Greater or equal
- == Equal
- != Not equal
- | Or
- & And

## Matrix operations

 - `matrix()` Creates matrix
 - `rbind()` Bind rows 
 - `cbind()` Bind columns
 - `ncol()` Number of columns  
 - `nrow()` Number of rows 
 - `t()` Transpose of a matrix 
 - `det()` Determinant of a matrix
 - `eigen()` Eigen values
 - `solve()` Solves equation
 - `diag()` Construct a diagonal matrix
 - `A%*%B` Dot product
 - `A%o%B` Outer product
 - `crossprod(A,B)` Return a matrix cross-product
 - `kronecker()` Computes the generalised kronecker product 
 
## Matrix examples

```{r eval = FALSE}
A <- matrix(c(2,5,7,1,6,12,3,2,2), byrow = TRUE, ncol = 3)
a <- c(2,5,7)
b <- c(1,6,12)
c <- c(3,2,2)
B <- rbind(a,b,c)
t(A) 
solve(A)
eigen(A) 
diag(4) 
```

To select an element in a matrix you can use `A[2,3]`. This gives the element in the second row and third column

## Data structure

- Vector (Atomic) is the fundamental data structure. There are six basic vector types: (1) Logical, (2) Integer, (3) Double, (4) Character, (5) Complex, (6) Raw. Use `c()` or `vector()` functions to create vectors. The elements of a vector are all of the same type.

- List is referred as generic vector. The elements may be different types. Use `list()` to create a list.

- Matrix is a two dimensional array. Use `matrix()` to create a matrix.

- Array is a multi-dimensional vector. All elements should be the same type. Use `array()`  to create an array

## Data frame

- Data frame is stored as a list of vectors, factors and/or matrices each of which has the same length. Use `data.frame()` to create a data frame.

```{r}
df <-  data.frame(a = c(1:10), b = rnorm(10, 0, 0.5), c = rep(c(1:2)))
```

```{r echo = FALSE}
library(knitr)
kable(head(df), caption = "Data Frame")
```

## Basic data functions

 - `head()` returns the first part of a vector
 - `tail()` returns the first part of a vector
 - `names()`,`colnames()` displays column names 
 - `dim()` retrieves the dimension of an object
 - `str()` displays the structure of an R Object
 - `table()` used for cross tabulation
 - `xtabs()` creates a contingency table 
 - `margin.table()` creates contingency table in array form
 - `prop.table()` express table nntries as a fraction of marginal table
 - `ftable()` creates ‘flat’ contingency tables

## Basic data functions - Examples

```{r}
library(datasets)
data(mtcars)
head(mtcars)
```

## Basic data functions - Examples

In basic R operations, you can use `with()` function to evaluate an expression in an environment constructed from data.

```{r}
## Create cross-table
with(mtcars, table(cyl, gear))
```

## Missing data

- `complete.cases()` returns a logical vector indicating which cases are complete
- `na.omit removes()` removes rows with missing data

```{r}
missing.values <-  c(1,2,NA, 4, 5, NA, 7, NA, NA)
complete.cases(missing.values)
na.omit(missing.values)
```

Many packages provide functions for handling missing data. Check **dplyr, Amelia, Hmisc, missForest** packages for examples.

## Import Data

 - `read.table(file)`
 - `read.csv(file)`
 - `read.csv2(file)`
 - `read.delim(file)`
 - `read.delim2(file)`

Check **readr, XLConnect** packages to import data from excel files

## Import Data

You can import data from other statistical programs using **foreign** and **Hmisc** packages

```{r eval = FALSE}
library(foreign)
library(Hmisc)
# SPSS 
data.spss <- read.spss("File name")

# SAS 
data.sas <- sasxport.get("File name")

# Stata
data.stata <- read.stata("File name")

# Systat 
data.systat <- read.systat("File name")
```

# BASIC DATA OPERATIONS

## Rename variable

Renaming a variable using `names()` function.

```{r}
library(datasets)
data(mtcars)
names(mtcars)
```

```{r}
names(mtcars)[2] = "lyc"
names(mtcars)
```

## Rename variables

**Tidyverse** is a collection of packages that are essential for data analysis. One of the most useful packages is the **dplyr** package. `rename()` package helps to rename variables.

`%>%` function is the pipeline function called from **magrittr** package. It simplifies analysis to a great extent.

```{r}
library(datasets)
library(dplyr)
data(mtcars)
mtcars <- mtcars %>%
  rename(MilesPGallon = mpg)
names(mtcars)
```

## Create a new variable

The base R function has `$` operator that acts on vectors, matrices, arrays and lists to extract or replace parts.

```{r}
library(datasets)
data(mtcars)
mtcars$mpgc <- mtcars$mpg / mtcars$cyl
summary(mtcars$mpgc)
```

We can do the same with `mutate()` function in **dplyr** package.

```{r eval = FALSE}
library(dplyr)
library(datasets)
data(mtcars)
mtcars <- mtcars %>%
  mutate( mpgc = mpg /cyl)
```

## Ordering variables

The base `order()` function rearranges the data set. `attach()` function attaches the dataset to the environment, so objects in the database can be accessed by simply giving their names. **dplyr** package has `arrange()` function for the same purpose, and it is more convenient.

```{r }
library(datasets)
data(mtcars)
attach(mtcars)
mtcars[order(mpg, decreasing = TRUE),] %>% 
  head()
```

## Merging datasets

The base `merge()` function merges data sets by common columns or row names. Similarly, `_join()` functions in dplyr packages offer more options. Compare these two data sets using `merge()` function.

```{r}
## Create two data frames 
df_1 <- data.frame(id = c(1,2,3), value = rnorm(3,1,0.2))
df_2 <- data.frame(id = c(3,4,5,6), value = rnorm(4,1,0.2))
new_df <- merge(df_1, df_2, by = "id")
new_df_1 <- merge(df_1, df_2, by = "id", all = TRUE)
print(new_df)
```

## Merging datasets using join functions

```{r eval = FALSE}
inner_join(x, y, by = NULL)
left_join(x, y, by = NULL)
right_join(x, y, by = NULL)
full_join(x, y, by = NULL)
anti_join(x, y, by = NULL)
```

```{r}
library(dplyr)
inner_join(df_1,df_2,by="id")
```

## Subsetting data

 - `X[n]` select nth element; nth row if dim > 2
 - `X[n,k]` select element from nth row, kth column 
 - `X[-n]` All but nth element
 - `X[1:n]` First n elements 
 - `X[c(a,b,c)]` select multiple elements 
 - `X[x > k]` selects elements greater than k
 - `X[x > k | x < k]` selects elements greater than or less
 
```{r}
library(datasets)
data(mtcars)
mtcars$mpg[10:15]
mtcars$mpg[mpg > 30]
```
 
## Subsetting data

The base `subset()` function and `filter()` or `select()`  functions from **dplyr** package offers more flexibility when subsetting data.

```{r}
library(datasets)
data(airquality)
subset(airquality, Temp > 80, select = c(Ozone, Temp)) %>% 
  head()
```

## Summarizing data sets

Use `summary()` function to summarize variables
```{r}
data(mtcars)
summary(mtcars[,1:4])
```

## Summarizing data sets

Row and column sums and menas can be retrieved by these functions:

```{r eval = FALSE}
colSums (x, na.rm = FALSE, dims = 1)
rowSums (x, na.rm = FALSE, dims = 1)
colMeans(x, na.rm = FALSE, dims = 1)
rowMeans(x, na.rm = FALSE, dims = 1)
```

```{r}
library(datasets)
data(mtcars)
colMeans(mtcars)
```

Note: There are many packages that offer summary tables such as **stargazer**.


## Stargazer package

```{r}
library(stargazer)
library(dplyr)
library(datasets)
data(mtcars)
mtcars %>% 
  select(hp, mpg,disp) %>% 
  stargazer(., median = TRUE, 
            iqr = TRUE, type = "text")

```

## Reshaping data sets

To reshape data, **tidyr** package has `pivot_()` functions (pivot_longer and pivot_wider). Assume we have 3 companies with daily average stock prices in USD. 

```{r}
require(tidyr)
set.seed(23)
stocks <- data.frame(
  DATE = as.Date('2017-01-01') + 0:9,
  A = as.integer(rnorm(10, 5, 1)),
  B = as.integer(rnorm(10, 10, 1)),
  C = as.integer(rnorm(10, 15, 1)))
stocks.long <- pivot_longer(stocks, A:C, names_to = "Companies",
                            values_to = "Price")
head(stocks.long)
```

## Strings

**stringr** package offers `str_()` functions to handle strings in R.

```{r eval = FALSE}
library(stringr)
str_to_upper(string, locale = "")
str_to_lower(string, locale = "")
str_to_title(string, locale = "")
str_count(string, pattern = "")
str_length(string)
str_detect(string, pattern)
str_extract(string, pattern)
str_replace(string, pattern, replacement)
str_sub(string, start = 1L, end = -1L)
str_trim(string, side = c("both", "left", "right"))
```

